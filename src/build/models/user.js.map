{"version":3,"sources":["../../models/user.js"],"names":["sequelize","DataTypes","User","define","uuid","STRING","firstName","lastName","phoneNumber","username","type","unique","validate","isAlphanumeric","args","msg","len","email","isEmail","password","hooks","afterValidate","user","bcrypt","hash","hashedPassword","associate","models","belongsToMany","Team","through","Member","foreignKey","name","field","Channel"],"mappings":";;;;;;;;;;;;;AAAA;;eAEe,kBAACA,SAAD,EAAYC,SAAZ,EAA0B;AACvC,MAAMC,IAAI,GAAGF,SAAS,CAACG,MAAV,CACX,MADW,EAEX;AACEC,IAAAA,IAAI,EAAEH,SAAS,CAACI,MADlB;AAEEC,IAAAA,SAAS,EAAEL,SAAS,CAACI,MAFvB;AAGEE,IAAAA,QAAQ,EAAEN,SAAS,CAACI,MAHtB;AAIEG,IAAAA,WAAW,EAAEP,SAAS,CAACI,MAJzB;AAKEI,IAAAA,QAAQ,EAAE;AACRC,MAAAA,IAAI,EAAET,SAAS,CAACI,MADR;AAERM,MAAAA,MAAM,EAAE,IAFA;AAGRC,MAAAA,QAAQ,EAAE;AACRC,QAAAA,cAAc,EAAE;AACdC,UAAAA,IAAI,EAAE,IADQ;AAEdC,UAAAA,GAAG,EAAE;AAFS,SADR;AAKRC,QAAAA,GAAG,EAAE;AACHF,UAAAA,IAAI,EAAE,CAAC,CAAD,EAAI,EAAJ,CADH;AAEHC,UAAAA,GAAG,EAAE;AAFF;AALG;AAHF,KALZ;AAmBEE,IAAAA,KAAK,EAAE;AACLP,MAAAA,IAAI,EAAET,SAAS,CAACI,MADX;AAELM,MAAAA,MAAM,EAAE,IAFH;AAGLC,MAAAA,QAAQ,EAAE;AACRM,QAAAA,OAAO,EAAE;AACPJ,UAAAA,IAAI,EAAE,IADC;AAEPC,UAAAA,GAAG,EAAE;AAFE;AADD;AAHL,KAnBT;AA6BEI,IAAAA,QAAQ,EAAE;AACRT,MAAAA,IAAI,EAAET,SAAS,CAACI,MADR;AAERO,MAAAA,QAAQ,EAAE;AACRI,QAAAA,GAAG,EAAE;AACHF,UAAAA,IAAI,EAAE,CAAC,CAAD,EAAI,GAAJ,CADH;AAEHC,UAAAA,GAAG,EAAE;AAFF;AADG;AAFF;AA7BZ,GAFW,EAyCX;AACEK,IAAAA,KAAK,EAAE;AACLC,MAAAA,aAAa;AAAA,2GAAE,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBACgBC,mBAAOC,IAAP,CAAYF,IAAI,CAACH,QAAjB,EAA2B,EAA3B,CADhB;;AAAA;AACPM,kBAAAA,cADO;AAEb;AACAH,kBAAAA,IAAI,CAACH,QAAL,GAAgBM,cAAhB;;AAHa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AADR;AADT,GAzCW,CAAb;;AAoDAvB,EAAAA,IAAI,CAACwB,SAAL,GAAiB,UAACC,MAAD,EAAY;AAC3BzB,IAAAA,IAAI,CAAC0B,aAAL,CAAmBD,MAAM,CAACE,IAA1B,EAAgC;AAC9BC,MAAAA,OAAO,EAAEH,MAAM,CAACI,MADc;AAE9BC,MAAAA,UAAU,EAAE;AACVC,QAAAA,IAAI,EAAE,QADI;AAEVC,QAAAA,KAAK,EAAE;AAFG;AAFkB,KAAhC,EAD2B,CAQ3B;;AACAhC,IAAAA,IAAI,CAAC0B,aAAL,CAAmBD,MAAM,CAACQ,OAA1B,EAAmC;AACjCL,MAAAA,OAAO,EAAE,gBADwB;AAEjCE,MAAAA,UAAU,EAAE;AACVC,QAAAA,IAAI,EAAE,QADI;AAEVC,QAAAA,KAAK,EAAE;AAFG;AAFqB,KAAnC;AAOD,GAhBD;;AAkBA,SAAOhC,IAAP;AACD,C","sourcesContent":["import bcrypt from 'bcrypt';\n\nexport default (sequelize, DataTypes) => {\n  const User = sequelize.define(\n    'user',\n    {\n      uuid: DataTypes.STRING,\n      firstName: DataTypes.STRING,\n      lastName: DataTypes.STRING,\n      phoneNumber: DataTypes.STRING,\n      username: {\n        type: DataTypes.STRING,\n        unique: true,\n        validate: {\n          isAlphanumeric: {\n            args: true,\n            msg: 'The username can only contain letters and numbers',\n          },\n          len: {\n            args: [3, 25],\n            msg: 'The username needs to be between 3 and 25 characters long',\n          },\n        },\n      },\n      email: {\n        type: DataTypes.STRING,\n        unique: true,\n        validate: {\n          isEmail: {\n            args: true,\n            msg: 'Invalid email or password',\n          },\n        },\n      },\n      password: {\n        type: DataTypes.STRING,\n        validate: {\n          len: {\n            args: [5, 100],\n            msg: 'The password needs to be between 5 and 100 characters long',\n          },\n        },\n      },\n    },\n    {\n      hooks: {\n        afterValidate: async (user) => {\n          const hashedPassword = await bcrypt.hash(user.password, 12);\n          // eslint-disable-next-line no-param-reassign\n          user.password = hashedPassword;\n        },\n      },\n    },\n  );\n\n  User.associate = (models) => {\n    User.belongsToMany(models.Team, {\n      through: models.Member,\n      foreignKey: {\n        name: 'userId',\n        field: 'user_id',\n      },\n    });\n    // N:M\n    User.belongsToMany(models.Channel, {\n      through: 'channel_member',\n      foreignKey: {\n        name: 'userId',\n        field: 'user_id',\n      },\n    });\n  };\n\n  return User;\n};\n"],"file":"user.js"}