{"version":3,"sources":["../permissions.js"],"names":["createResolver","resolver","baseResolver","childResolver","newResolver","parent","args","context","info","user","id","Error","requiresTeamAccess","channelId","models","Channel","findOne","where","channel","Member","teamId","user_id","member","directMessageSubscription","userId","Op","Sequelize","findAll","or","members","length"],"mappings":"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","sourcesContent":["import Sequelize from 'sequelize';\n\nconst createResolver = (resolver) => {\n  const baseResolver = resolver;\n  baseResolver.createResolver = (childResolver) => {\n    const newResolver = async (parent, args, context, info) => {\n      await resolver(parent, args, context, info);\n      return childResolver(parent, args, context, info);\n    };\n    return createResolver(newResolver);\n  };\n  return baseResolver;\n};\n\n// TODO: Continue trying to figure out why this returns false for logged in user when meQuery is run on ViewTeam page.\n// requiresAuth\nexport default createResolver((parent, args, { user }) => {\n  if (!user || !user.id) {\n    throw new Error('Not authenticated');\n  }\n});\n\n// requiresTeamAccess\nexport const requiresTeamAccess = createResolver(async (parent, { channelId }, { user, models }) => {\n  if (!user || !user.id) {\n    throw new Error('Not authenticated, team access.');\n  }\n\n  // Check if part of the team\n  const channel = await models.Channel.findOne({ where: { id: channelId } });\n  const member = await models.Member.findOne({\n    where: { teamId: channel.teamId, user_id: user.id },\n  });\n\n  if (!member) {\n    throw new Error(`You have to be a member of the team to subscribe to it's messages.`);\n  }\n});\n\n// export const requiresTeamAccess = createResolver((parent, args, { user }) => {\n//   console.log('requiresTeamAccess');\n// });\n\n// directMessage subscription\nexport const directMessageSubscription = createResolver(\n  async (parent, { teamId, userId }, { user, models }) => {\n    if (!user || !user.id) {\n      throw new Error('Not authenticated, directmessages.');\n    }\n\n    const Op = Sequelize.Op;\n\n    const members = await models.Member.findAll({\n      where: {\n        teamId,\n        [Op.or]: [{ userId }, { userId: user.id }],\n      },\n    });\n\n    if (members.length < 1) {\n      throw new Error('Something went wrong');\n    }\n  },\n);\n"],"file":"permissions.js"}