{"version":3,"sources":["../../resolvers/channel.js"],"names":["Mutation","createChannel","requiresAuth","createResolver","parent","args","models","user","Member","findOne","where","teamId","userId","id","raw","member","admin","ok","errors","path","message","shortid","generate","Channel","create","channel","console","log"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;AACA;;eAEe;AACbA,EAAAA,QAAQ,EAAE;AACRC,IAAAA,aAAa,EAAEC,wBAAaC,cAAb;AAAA,+FAA4B,iBAAOC,MAAP,EAAeC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuBC,gBAAAA,MAAvB,SAAuBA,MAAvB,EAA+BC,IAA/B,SAA+BA,IAA/B;AAAA;AAAA;AAAA,uBAElBD,MAAM,CAACE,MAAP,CAAcC,OAAd,CACnB;AAAEC,kBAAAA,KAAK,EAAE;AAAEC,oBAAAA,MAAM,EAAEN,IAAI,CAACM,MAAf;AAAuBC,oBAAAA,MAAM,EAAEL,IAAI,CAACM;AAApC;AAAT,iBADmB,EAEnB;AAAEC,kBAAAA,GAAG,EAAE;AAAP,iBAFmB,CAFkB;;AAAA;AAEjCC,gBAAAA,MAFiC;;AAAA,oBAMlCA,MAAM,CAACC,KAN2B;AAAA;AAAA;AAAA;;AAAA,iDAO9B;AACLC,kBAAAA,EAAE,EAAE,KADC;AAELC,kBAAAA,MAAM,EAAE,CACN;AACEC,oBAAAA,IAAI,EAAE,MADR;AAEEC,oBAAAA,OAAO,EAAE;AAFX,mBADM;AAFH,iBAP8B;;AAAA;AAiBvCf,gBAAAA,IAAI,CAAC,MAAD,CAAJ,GAAegB,oBAAQC,QAAR,EAAf;AAjBuC;AAAA,uBAmBjBhB,MAAM,CAACiB,OAAP,CAAeC,MAAf,CAAsBnB,IAAtB,CAnBiB;;AAAA;AAmBjCoB,gBAAAA,OAnBiC;AAAA,iDAqBhC;AACLR,kBAAAA,EAAE,EAAE,IADC;AAELQ,kBAAAA,OAAO,EAAPA;AAFK,iBArBgC;;AAAA;AAAA;AAAA;AA0BvCC,gBAAAA,OAAO,CAACC,GAAR;AA1BuC,iDA2BhC;AACLV,kBAAAA,EAAE,EAAE,KADC;AAELC,kBAAAA,MAAM,EAAE,2CAAkBZ,MAAlB;AAFH,iBA3BgC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA5B;;AAAA;AAAA;AAAA;AAAA;AADP;AADG,C","sourcesContent":["import formatErrors from '../formatErrors';\nimport requiresAuth from '../permissions';\nimport shortid from 'shortid';\n\nexport default {\n  Mutation: {\n    createChannel: requiresAuth.createResolver(async (parent, args, { models, user }) => {\n      try {\n        const member = await models.Member.findOne(\n          { where: { teamId: args.teamId, userId: user.id } },\n          { raw: true },\n        );\n        if (!member.admin) {\n          return {\n            ok: false,\n            errors: [\n              {\n                path: 'name',\n                message: 'You have to be the owner of the team to create channels',\n              },\n            ],\n          };\n        }\n        args['uuid'] = shortid.generate();\n\n        const channel = await models.Channel.create(args);\n\n        return {\n          ok: true,\n          channel,\n        };\n      } catch (err) {\n        console.log(err);\n        return {\n          ok: false,\n          errors: formatErrors(err, models),\n        };\n      }\n    }),\n  },\n};\n"],"file":"channel.js"}